#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุฅุถุงูุฉ ููุฒุฉ ููู ุงูุฅูุฌุงุฒ
ูุฑูุฒ ุงูููููุจูู ุจุญุงุฆู
"""

from app import app, db, Achievement, AchievementFile
import os

def update_database():
    """ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ"""
    
    print("๐ ุจุฏุก ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช...")
    
    with app.app_context():
        try:
            # ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ
            db.create_all()
            print("โ ุชู ุฅูุดุงุก ุฌุฏุงูู ููู ุงูุฅูุฌุงุฒ ุจูุฌุงุญ")
            
            # ุงูุชุญูู ูู ูุฌูุฏ ูุฌูุฏ ุงูุฑูุน
            upload_folder = app.config['UPLOAD_FOLDER']
            if not os.path.exists(upload_folder):
                os.makedirs(upload_folder)
                print(f"โ ุชู ุฅูุดุงุก ูุฌูุฏ ุงูุฑูุน: {upload_folder}")
            else:
                print(f"โ ูุฌูุฏ ุงูุฑูุน ููุฌูุฏ: {upload_folder}")
            
            # ุนุฑุถ ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
            achievement_count = Achievement.query.count()
            file_count = AchievementFile.query.count()
            
            print(f"๐ ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:")
            print(f"   - ุนุฏุฏ ุงูุฅูุฌุงุฒุงุช: {achievement_count}")
            print(f"   - ุนุฏุฏ ุงููููุงุช: {file_count}")
            
            print("๐ ุชู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ!")
            print("\n๐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ุงููุชุงุญุฉ:")
            print("   โ ุฅุถุงูุฉ ูุชุนุฏูู ูุญุฐู ุงูุฅูุฌุงุฒุงุช")
            print("   โ ุฑูุน ูุฅุฏุงุฑุฉ ุงููููุงุช ุงููุฑููุฉ")
            print("   โ ุชุตููุฉ ุงูุฅูุฌุงุฒุงุช ุญุณุจ ุงูููุน")
            print("   โ ุทุจุงุนุฉ ููู ุงูุฅูุฌุงุฒ")
            print("   โ ุฃุฒุฑุงุฑ ุงูุชุนุฏูู ูู ุฌููุน ุงูุดุงุดุงุช")
            
        except Exception as e:
            print(f"โ ุฎุทุฃ ูู ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช: {str(e)}")
            return False
    
    return True

def add_sample_data():
    """ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ (ุงุฎุชูุงุฑู)"""
    
    print("\n๐ ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ...")
    
    with app.app_context():
        try:
            # ุงูุชุญูู ูู ูุฌูุฏ ูุณุชุฎุฏููู
            from app import User
            users = User.query.all()
            
            if not users:
                print("โ๏ธ  ูุง ุชูุฌุฏ ูุณุชุฎุฏููู ูู ุงููุธุงู")
                return False
            
            # ุฅุถุงูุฉ ุฅูุฌุงุฒ ุชุฌุฑูุจู ูููุณุชุฎุฏู ุงูุฃูู
            user = users[0]
            
            # ุงูุชุญูู ูู ุนุฏู ูุฌูุฏ ุฅูุฌุงุฒุงุช ูุณุจูุฉ
            existing_achievements = Achievement.query.filter_by(user_id=user.id).count()
            
            if existing_achievements == 0:
                sample_achievement = Achievement(
                    title="ุดูุงุฏุฉ ุชูุฏูุฑ ููุฃุฏุงุก ุงููุชููุฒ",
                    description="ุดูุงุฏุฉ ุชูุฏูุฑ ูู ุฅุฏุงุฑุฉ ุงููุฑูุฒ ููุฃุฏุงุก ุงููุชููุฒ ูู ุงูุนุงู ุงูุฏุฑุงุณู 2024",
                    achievement_type="ุดูุงุฏุฉ",
                    date_achieved=db.func.current_date(),
                    user_id=user.id
                )
                
                db.session.add(sample_achievement)
                db.session.commit()
                
                print(f"โ ุชู ุฅุถุงูุฉ ุฅูุฌุงุฒ ุชุฌุฑูุจู ูููุณุชุฎุฏู: {user.full_name}")
            else:
                print(f"โน๏ธ  ุงููุณุชุฎุฏู {user.full_name} ูุฏูู {existing_achievements} ุฅูุฌุงุฒ ูุณุจูุงู")
                
        except Exception as e:
            print(f"โ ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุจูุงูุงุช ุงูุชุฌุฑูุจูุฉ: {str(e)}")
            return False
    
    return True

if __name__ == "__main__":
    print("=" * 60)
    print("๐ ุชุญุฏูุซ ูุธุงู ุฅุฏุงุฑุฉ ููุงู ูุฑูุฒ ุงูููููุจูู ุจุญุงุฆู")
    print("   ุฅุถุงูุฉ ููุฒุฉ ููู ุงูุฅูุฌุงุฒ")
    print("   ุจูุงุณุทุฉ: ุฏูุชูุฑูุช by DrNeT")
    print("=" * 60)
    
    # ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
    if update_database():
        # ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ (ุงุฎุชูุงุฑู)
        response = input("\nโ ูู ุชุฑูุฏ ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉุ (y/n): ").lower().strip()
        if response in ['y', 'yes', 'ูุนู']:
            add_sample_data()
        
        print("\n๐ฏ ุงูุชุญุฏูุซ ููุชูู! ููููู ุงูุขู:")
        print("   1. ุชุดุบูู ุงูุชุทุจูู: python app.py")
        print("   2. ุงูุฏุฎูู ุฅูู ุงููุธุงู")
        print("   3. ุงููุตูู ูููู ุงูุฅูุฌุงุฒ ูู ุงูุดุฑูุท ุงูุฌุงูุจู")
        print("\n๐ ุงุณุชูุชุน ุจุงูููุฒุงุช ุงูุฌุฏูุฏุฉ!")
    else:
        print("\nโ ูุดู ูู ุงูุชุญุฏูุซ. ูุฑุฌู ูุฑุงุฌุนุฉ ุงูุฃุฎุทุงุก ุฃุนูุงู.")